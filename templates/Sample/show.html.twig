{% extends "base.html.twig" %}
{% import 'macros.html.twig' as macro %}

{% block body %}
    <h2>{{ sample.sha256 }}</h2>
    <ul class="nav nav-tabs" id="sampleTab" role="tablist">
        <li class="nav-item" role="presentation">
            <button class="nav-link" id="metadata-tab" data-bs-toggle="tab" data-bs-target="#metadata"
                    type="button" role="tab" aria-controls="metadata" aria-selected="false">
                Metadata
            </button>
        </li>
        <li class="nav-item" role="presentation">
            <button class="nav-link" id="relatedFiles-tab" data-bs-toggle="tab" data-bs-target="#relatedFiles"
                    type="button" role="tab" aria-controls="relatedFiles" aria-selected="false">
                Related Files
            </button>
        </li>
        {% if sample.email %}
            <li class="nav-item" role="presentation">
                <button class="nav-link active" id="email-tab" data-bs-toggle="tab" data-bs-target="#email"
                        type="button" role="tab" aria-controls="email" aria-selected="true">
                    E-Mail
                </button>
            </li>
        {% endif %}
    </ul>
    <div class="tab-content" id="sampleTabContent">
        <div class="tab-pane fade" id="metadata" role="tabpanel" aria-labelledby="metadata-tab">
            <div class="row">
                <div class="col-4">
                    <dl class="row">
                        <dt class="col-sm-3">SHA256</dt>
                        <dd class="col-sm-9 text-truncate">{{ sample.sha256 }}</dd>
                        <dt class="col-sm-3">MD5</dt>
                        <dd class="col-sm-9">{{ sample.md5 }}</dd>
                        <dt class="col-sm-3">SHA1</dt>
                        <dd class="col-sm-9">{{ sample.sha1 }}</dd>
                        <dt class="col-sm-3">CRC32</dt>
                        <dd class="col-sm-9">{{ sample.crc32 }}</dd>
                        {% if sample.size %}
                            <dt class="col-sm-3">Size</dt>
                            <dd class="col-sm-9">{{ sample.size|fileSize }}</dd>
                        {% endif %}
                        {% if sample.fileMagic %}
                            <dt class="col-sm-3">Magic</dt>
                            <dd class="col-sm-9">{{ sample.fileMagic }}</dd>
                        {% endif %}
                        {% if sample.fileNames %}
                            <dt class="col-sm-3">Names</dt>
                            <dd class="col-sm-9">{{ sample.fileNames|join(', ') }}</dd>
                        {% endif %}
                    </dl>
                </div>
            </div>
        </div>
        <div class="tab-pane fade" id="relatedFiles" role="tabpanel" aria-labelledby="relatedFiles-tab">
            {% if children|length+parents|length == 0 %}
                <i>No related files</i>
            {% else %}
                <table class="table table-striped table-bordered">
                    <thead>
                    <tr>
                        <th>Type</th>
                        <th>SHA256</th>
                        <th>Size</th>
                        <th>Filenames</th>
                        <th>Timestamps</th>
                        <th>Processor</th>
                    </tr>
                    </thead>
                    <tbody>
                    {% for subfile in children %}
                        <tr>
                            <td>Child</td>
                            <td>
                                <a href="{{ path('app_sample_sample', {'sha256': subfile.child.sha256}) }}"><i
                                        class="fa-solid fa-eye"></i></a>
                                {{ subfile.child.sha256 }}
                            </td>
                            <td>{{ subfile.child.size ? subfile.child.size|fileSize : '-' }}</td>
                            <td>
                                {{ sample.fileNames|join(" ") }}
                                {% for path in subfile.paths %}
                                    {{ path.fileName }}
                                {% endfor %}
                            </td>
                            <td>
                                {% for path in subfile.paths %}
                                    {% for timestamp in path.timestamps %}
                                        {% if timestamp.description is empty %}
                                            {{ timestamp.value|formatDateTimeAllowEmpty }}
                                        {% endif %}
                                    {% endfor %}
                                    <dl class="row">
                                        {% for timestamp in path.timestamps %}
                                            {% if timestamp.description is not empty %}
                                                <dt class="col-sm-3">{{ timestamp.description }}</dt>
                                                <dd class="col-sm-9 text-truncate">{{ timestamp.value|formatDateTimeAllowEmpty }}</dd>
                                            {% endif %}
                                        {% endfor %}
                                    </dl>
                                {% endfor %}
                            </td>
                            <td>{% for path in subfile.paths %}{{ path.processorName }} {% endfor %}</td>
                        </tr>
                    {% endfor %}
                    {% for subfile in parents %}
                        <tr>
                            <td>Parent</td>
                            <td>
                                <a href="{{ path('app_sample_sample', {'sha256': subfile.parent.sha256}) }}"><i
                                        class="fa-solid fa-eye"></i></a>
                                {{ subfile.parent.sha256 }}
                            </td>
                            <td>{{ subfile.parent.size ? subfile.parent.size|fileSize : '-' }}</td>
                            <td>
                                {{ sample.fileNames|join(" ") }}
                                {% for path in subfile.paths %}
                                    {{ path.fileName }}
                                {% endfor %}
                            </td>
                            <td>
                                {% for path in subfile.paths %}
                                    {% for timestamp in path.timestamps %}
                                        {% if timestamp.description is empty %}
                                            {{ timestamp.value|formatDateTimeAllowEmpty }}
                                        {% endif %}
                                    {% endfor %}
                                    <dl class="row">
                                        {% for timestamp in path.timestamps %}
                                            {% if timestamp.description is not empty %}
                                                <dt class="col-sm-3">{{ timestamp.description }}</dt>
                                                <dd class="col-sm-9 text-truncate">{{ timestamp.value|formatDateTimeAllowEmpty }}</dd>
                                            {% endif %}
                                        {% endfor %}
                                    </dl>
                                {% endfor %}
                            </td>
                            <td>{% for path in subfile.paths %}{{ path.processorName }} {% endfor %}</td>
                        </tr>
                    {% endfor %}
                    </tbody>
                </table>
            {% endif %}
        </div>
        {% if sample.email %}
            <div class="tab-pane fade show active" id="email" role="tabpanel" aria-labelledby="email-tab">
                <dl class="row">
                    {% if sample.email.from is defined %}
                        <dt class="col-sm-3">From</dt>
                        <dd class="col-sm-9 text-truncate">{{ macro.emailAddressList(sample.email.from, sample.email.from_names is defined ? sample.email.from_names : []) }}</dd>
                    {% endif %}
                    {% if sample.email.to is defined %}
                        <dt class="col-sm-3">To</dt>
                        <dd class="col-sm-9 text-truncate">{{ macro.emailAddressList(sample.email.to, sample.email.to_names is defined ? sample.email.to_names : []) }}</dd>
                    {% endif %}
                    {% if sample.email.cc is defined %}
                        <dt class="col-sm-3">CC</dt>
                        <dd class="col-sm-9 text-truncate">{{ macro.emailAddressList(sample.email.cc, sample.email.cc_names is defined ? sample.email.cc_names : []) }}</dd>
                    {% endif %}
                    {% if sample.email.bcc is defined %}
                        <dt class="col-sm-3">BCC</dt>
                        <dd class="col-sm-9 text-truncate">{{ macro.emailAddressList(sample.email.bcc, sample.email.bcc_names is defined ? sample.email.bcc_names : []) }}</dd>
                    {% endif %}
                    {% if sample.email.in_reply_to is defined %}
                        <dt class="col-sm-3">In-Reply-To</dt>
                        <dd class="col-sm-9 text-truncate">{{ macro.emailAddressList(sample.email.in_reply_to, sample.email.in_reply_to_names is defined ? sample.email.in_reply_to_names : []) }}</dd>
                    {% endif %}
                    {% if sample.email.return_path is defined %}
                        <dt class="col-sm-3">Return-Path</dt>
                        <dd class="col-sm-9 text-truncate">{{ macro.emailAddressList(sample.email.return_path, sample.email.return_path_names is defined ? sample.email.return_path_names : []) }}</dd>
                    {% endif %}
                    {% if sample.email.reply_to is defined %}
                        <dt class="col-sm-3">Reply-To</dt>
                        <dd class="col-sm-9 text-truncate">{{ macro.emailAddressList(sample.email.reply_to, sample.email.reply_to_names is defined ? sample.email.reply_to_names : []) }}</dd>
                    {% endif %}
                    {% if sample.email.return_receipt_to is defined %}
                        <dt class="col-sm-3">Return-Receipt-To</dt>
                        <dd class="col-sm-9 text-truncate">{{ macro.emailAddressList(sample.email.return_receipt_to, sample.email.return_receipt_to_names is defined ? sample.email.return_receipt_to_names : []) }}</dd>
                    {% endif %}
                    {% if sample.email.sender is defined %}
                        <dt class="col-sm-3">Sender</dt>
                        <dd class="col-sm-9 text-truncate">{{ macro.emailAddressList(sample.email.sender, sample.email.sender_names is defined ? sample.email.sender_names : []) }}</dd>
                    {% endif %}
                    {% if sample.email.envelope_from is defined %}
                        <dt class="col-sm-3">Envelope-From</dt>
                        <dd class="col-sm-9 text-truncate">{{ macro.emailAddressList(sample.email.envelope_from, sample.email.envelope_from_names is defined ? sample.email.envelope_from_names : []) }}</dd>
                    {% endif %}
                    {% if sample.email.envelope_to is defined %}
                        <dt class="col-sm-3">Envelope-To</dt>
                        <dd class="col-sm-9 text-truncate">{{ macro.emailAddressList(sample.email.envelope_to, sample.email.envelope_to_names is defined ? sample.email.envelope_to_names : []) }}</dd>
                    {% endif %}
                    {% if sample.email.disposition_notification_to is defined %}
                        <dt class="col-sm-3">Disposition-Notification-To</dt>
                        <dd class="col-sm-9 text-truncate">{{ macro.emailAddressList(sample.email.disposition_notification_to, sample.email.disposition_notification_to_names is defined ? sample.email.disposition_notification_to_names : []) }}</dd>
                    {% endif %}
                    {% if sample.email.return_receipt_to is defined %}
                        <dt class="col-sm-3">Return-Receipt-To</dt>
                        <dd class="col-sm-9 text-truncate">{{ macro.emailAddressList(sample.email.return_receipt_to, sample.email.return_receipt_to_names is defined ? sample.email.return_receipt_to_names : []) }}</dd>
                    {% endif %}
                    {% if sample.email.abuse_reports_to is defined %}
                        <dt class="col-sm-3">Abuse-Reports-To</dt>
                        <dd class="col-sm-9 text-truncate">{{ macro.emailAddressList(sample.email.abuse_reports_to, sample.email.abuse_reports_to_names is defined ? sample.email.abuse_reports_to_names : []) }}</dd>
                    {% endif %}
                    {% if sample.email.mail_reply_to is defined %}
                        <dt class="col-sm-3">Mail-Reply-To</dt>
                        <dd class="col-sm-9 text-truncate">{{ macro.emailAddressList(sample.email.mail_reply_to, sample.email.mail_reply_to_names is defined ? sample.email.mail_reply_to_names : []) }}</dd>
                    {% endif %}
                    {% if sample.email.savedfromemail is defined %}
                        <dt class="col-sm-3">Savedfromemail</dt>
                        <dd class="col-sm-9 text-truncate">{{ macro.emailAddressList(sample.email.savedfromemail, sample.email.savedfromemail_names is defined ? sample.email.savedfromemail_names : []) }}</dd>
                    {% endif %}
                    <dt class="col-sm-3">Subject</dt>
                    <dd class="col-sm-9 text-truncate">{{ sample.email.subject }}</dd>
                    {% if sample.email.organization is defined %}
                        <dt class="col-sm-3">Organization</dt>
                        <dd class="col-sm-9 text-truncate">{{ sample.email.organization }}</dd>
                    {% endif %}
                    <dt class="col-sm-3">Thread Topic</dt>
                    <dd class="col-sm-9 text-truncate">{{ sample.email.thread_topic }}</dd>
                    <dt class="col-sm-3">Thread Index</dt>
                    <dd class="col-sm-9 text-truncate">
                        <a href="#"><i class="fa-brands fa-searchengin"></i></a>{{ sample.email.thread_index }}
                    </dd>
                    {% if sample.email.message_uuid is defined or sample.email.message_host_id is defined %}
                        <dt class="col-sm-3">Message UUID@Host ID</dt>
                        <dd class="col-sm-9 text-truncate">
                            <a href="#"><i class="fa-brands fa-searchengin"></i></a>{{ sample.email.message_uuid }}@<a
                                href="#"><i class="fa-brands fa-searchengin"></i></a>{{ sample.email.message_host_id }}
                        </dd>
                    {% endif %}
                    {% if sample.email.list_uuid is defined or sample.email.list_host_id is defined %}
                        <dt class="col-sm-3">List UUID@Host ID</dt>
                        <dd class="col-sm-9 text-truncate">
                            <a href="#"><i class="fa-brands fa-searchengin"></i></a>{{ sample.email.list_uuid }}@<a
                                href="#"><i class="fa-brands fa-searchengin"></i></a>{{ sample.email.list_host_id }}
                        </dd>
                    {% endif %}
                    {% if sample.email.content_uuid is defined or sample.email.content_host_id is defined %}
                        <dt class="col-sm-3">Content UUID@Host ID</dt>
                        <dd class="col-sm-9 text-truncate">
                            <a href="#"><i class="fa-brands fa-searchengin"></i></a>{{ sample.email.content_uuid }}@<a
                                href="#"><i class="fa-brands fa-searchengin"></i></a>{{ sample.email.content_host_id }}
                        </dd>
                    {% endif %}
                    {% if sample.email.references is defined %}
                        <dt class="col-sm-3">References</dt>
                        <dd class="col-sm-9 text-truncate">
                            {% for reference in sample.email.references %}
                                <a href="#"><i class="fa-brands fa-searchengin"></i></a>{{ reference.uuid }}@<a
                                href="#"><i
                                    class="fa-brands fa-searchengin"></i></a>{{ reference.host_id }}<br/>
                            {% endfor %}
                        </dd>
                    {% endif %}
                    <dt class="col-sm-3">Date</dt>
                    <dd class="col-sm-9 text-truncate">{{ sample.email.date }}</dd>
                    {% if sample.email.received %}
                        <dt class="col-sm-3">Received</dt>
                        <dd class="col-sm-9">
                            {% for receivedLine in sample.email.received %}
                                {{ receivedLine }}<br>
                            {% endfor %}
                        </dd>
                    {% endif %}
                    {% for x_header in sample.email.x_headers %}

                    {% endfor %}
                </dl>
                {% if sample.email.body is defined %}
                    {{ sample.email.body|nl2br }}
                {% endif %}
            </div>
        {% endif %}
    </div>
{% endblock %}
